### --------------------------------------------------------------------------------------------------------------------
### Variables
### (https://www.gnu.org/software/make/manual/html_node/Using-Variables.html#Using-Variables)
### --------------------------------------------------------------------------------------------------------------------
BUILD_DIR ?= $(CURDIR)/out

### --------------------------------------------------------------------------------------------------------------------
### RULES
### (https://www.gnu.org/software/make/manual/html_node/Rule-Introduction.html#Rule-Introduction)
### --------------------------------------------------------------------------------------------------------------------
.PHONY: all

all: clean deps test

#-----------------------------------------------------------------------------------------------------------------------
# Housekeeping - Cleans our project: deletes binaries
#-----------------------------------------------------------------------------------------------------------------------
.PHONY: clean

clean:
	echo "Cleaning"
	go clean -v

#-----------------------------------------------------------------------------------------------------------------------
# Dependencies
#-----------------------------------------------------------------------------------------------------------------------
.PHONY: deps

deps:
	echo "Installing dependencies"
	dep ensure -v

#-----------------------------------------------------------------------------------------------------------------------
# Testing
#-----------------------------------------------------------------------------------------------------------------------
.PHONY: test test-unit

test: test-unit test-examples

test-unit:
	echo "Running unit tests"
	go test -v -race ./...

test-examples:
	echo "Running examples"
	go run -race example/aggregate/*.go
	go run -race example/repository/*.go

